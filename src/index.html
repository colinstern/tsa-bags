<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="css/dc.css" />
  <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
  <script src="js/d3.js"></script>
  <script src="js/crossfilter.js"></script>
  <script src="js/dc.js"></script>
  <script src="js/reductio.js"></script>
  <script src="js/universe.js"></script>
  <script type="text/javascript" src="js/colorbrewer.js"></script>
  <style>
  </style>
  <title>TSA Claims Dataset</title>

</head>

<body>
<!-- CSS -->
<style type="text/css">
</style>

<!-- HTML -->

<div class="container">

  <h1>TSA Claims Dataset Metrics</h1>
  <h4>By <a href="http://cstern.me/">Colin Stern</a></h4>

  <h3>Time for a Vacation</h3>
  <div><span>​You're taking some much needed time off from work in Ney York City and you're planning to spend it in Miami, lounging on the beach sipping margaritas. However, since you don't live anywhere near Miami, <b>you're going to need to take a flight</b>.</span> </div>
  <img class="center-block" src="img/airplane-shape.svg" alt="View" style="width:100;height:100px;">
  <div> However, you want this flight to be as stress-free as possible - you've dealt with plenty of stress at work. You decide that losing bags is one of the most stressful experiences that could happen on your flight, so you decide to try to <b>minimize the possibility</b>.
  </div>
  <img class="center-block" src="img/bag.png" alt="View" style="width:140;height:140px;">
  <div> After some googling, you find historical records of claims from passengers sent to the TSA asking for compensation for lost or damaged bags. Using the data, you decide to plan your trip to avoid the airports and airlines which are most likely to ruin your trip by losing your bag. <b>Which airports and airlines should you avoid, and which should you fly?</b></div>
    <img class="center-block" src="img/takeoff-the-plane.svg" alt="View" style="width:140;height:140px;">
    </span>

  <div style="padding-bottom:15px;">Let's take a look at the <b>worst offending airports....</b></div>

<!-- Heatmap - Airports by Volume of Claims-->
<div class="row">
  <div id="heatmap">
       <strong>Airports by Volume of Claims</strong>
       <a class="reset" href="javascript:airportHeatmap.filterAll();dc.redrawAll();" style="display: none;">reset</a>
       <div class="clearfix"></div>
       <div class="row">
         <div id="heat-select">
           <div>
             <a class="reset"
                href="javascript:heatSelect.filterAll();dc.redrawAll();"
                style="visibility: hidden;">reset</a>
           </div>
         </div>
       </div>
   </div>
</div>

  <p>​Clearly, <b>JFK</b> and <b>LaGuardia</b> lose the most bags of any airports in the area, while <b>Westchester County Airport</b> and <b>Stewart International Airport</b> are better alternatives. In Florida, meanwhile, <b>Miami International Airport</b> is slighlty better than <b>Orlando International Airport</b>.</p>


<!-- Heatmap key -->
<div class="row">
  <div id="heatmapKey">
    <div class="clearfix"></div>
  </div>
</div>

   <!--  Parallel coordinates - Correlations between Airport, Airline, Where Item was Lost, Close Amount and Disposition of Claim goes here -->
<!-- <div class="row">
   <div id="parallel-coordinates">
        <strong>Correlations between Airport, Airline, Where Item was Lost, Close Amount and Disposition of Claim</strong>
        <a class="reset" href="javascript:parallelCoordinates.filterAll();dc.redrawAll();" style="display: none;">reset</a>
        <div class="clearfix"></div>
        <div class="row">
        </div>
   </div>
 </div> -->


   <p>​Now let's look at the <b>airlines...</b></p>


   <!-- Number of selected records -->
  <div class="row">
      <div>
          <div class="dc-data-count">
              <span class="filter-count"></span> selected out of <span class="total-count"></span> records | <a
                  href="javascript:dc.filterAll(); dc.renderAll();">Reset All</a>
          </div>
      </div>
      <table class="table table-hover dc-data-table">
      </table>
  </div>
  <div class="clearfix"></div>

   <!-- Histogram - Number of Claims by Airline -->
<div class="row">
     <div id="number-claims-by-airline-histogram">
          <strong>Number of Claims by Airline</strong>
          <a class="reset" href="javascript:numberClaimsByAirlineHistogram.filterAll();dc.redrawAll();" style="display: none;">reset</a>
          <div class="clearfix"></div>
          <div class="row">
            <div id="number-claims-by-airline-select">
              <div>
                <a class="reset"
                   href="javascript:numberClaimsByAirlineSelect.filterAll();dc.redrawAll();"
                   style="visibility: hidden;">reset</a>
              </div>
            </div>
          </div>
     </div>
</div>
<p style="padding-bottom:15px;">Our data says that <b>Southwest</b> and <b>Delta</b> lose the most bags, while <b>Virgin America</b> and <b>Emirates</b> are better alternatives.</p>

<!-- Line chart - Volume of Claims -->
<p style="padding-bottom:15px;">Alright, we have an idea of our origin and destination airports and which airline we're going to fly. But what is the <b>best time of year to fly?</b></p>
<div class="row">
    <div id="volume-claims-line">
        <strong>Volume of Claims</strong>
        <span class="reset" style="display: none;">range: <span class="filter"></span></span>
        <a class="reset" href="javascript:volumeClaimsLine.filterAll();likeChart.filterAll();dc.redrawAll();"
           style="display: none;">reset</a>
        <div class="clearfix"></div>
        <div class="row">
          <div id="volume-claims-line-select">
            <div>
              <a class="reset"
                 href="javascript:volumeClaimsLineSelect.filterAll();dc.redrawAll();"
                 style="visibility: hidden;">reset</a>
            </div>
          </div>
        </div>

  <!-- Linked bar chart to line chart -->
      <div id="volume-claims-line-slider">
      </div>
      <p class="muted pull-right" style="margin-right: 15px;"></p>
</div>
</div>

<p style="padding-bottom:15px;">It looks like baggage loss is fairly constant throughout the year, although <b>January</b> and <b>July</b> are slightly worse than average. <b>February</b> and <b>November</b> look slightly better - a perfect time to be a Florida Snowbird! </p>

<!-- Histogram - Percent of Denied Claims by Airport -->
<p style="padding-bottom:15px;">But what happens if you <i>do</i> lose your bags? Which airport is <b>most likely to compensate you?</b></p>
<div class="row">
  <div id="percent-denied-claims-by-airport-histogram">
       <strong>Percent of Denied Claims by Airport</strong>
       <a class="reset" href="javascript:percentDeniedByAirportHistogram.filterAll();dc.redrawAll();" style="display: none;">reset</a>
       <div class="clearfix"></div>
       <div class="row">
         <div id="percent-denied-by-airport-select">
           <div>
             <a class="reset"
                href="javascript:percentDeniedByAirportSelect.filterAll();dc.redrawAll();"
                style="visibility: hidden;">reset</a>
           </div>
         </div>
       </div>
   </div>
 </div>

 <p style="padding-bottom:15px;"><b>JFK</b> denies 60% of claims, which is about average. Meanwhile, <b>Westchester County Airport</b> denies 75% of claims, a bit worse. In Florida, you might find that flying into <b>Fort Lauderdale International Airport</b> is worth the drive to Miami since only 56% of claims are denied. However, it seems that no matter what, getting compensated is 50/50 at best.</p>
  <!-- Histogram - Number of Claims by Item Type -->
  <p style="padding-bottom:15px;">As for the <b>types of stuff lost...</b></p>
<div class="row">
    <div id="number-of-claims-by-item-histogram">
         <strong>Number of Claims by Item Type</strong>
         <a class="reset" href="javascript:numberClaimsItemHistogram.filterAll();dc.redrawAll();" style="display: none;">reset</a>
         <div class="clearfix"></div>
         <div class="row">
           <div id="number-claims-item-histogram-select">
             <div>
               <a class="reset"
                  href="javascript:numberClaimsItemHistogramSelect.filterAll();dc.redrawAll();"
                  style="visibility: hidden;">reset</a>
             </div>	
         </div>
       </div>
    </div>

</div>
<p style="padding-bottom:15px;">​Airlines seem to lose a lot of <b>clothing</b>, and not a lot of <b>cameras</b>. So bring <b>clothing</b> in your carry-on instead!</p>

<h4>In conclusion,</h4>
 <p style="padding-bottom:15px;">​if we're flying from the New York area, we'll want to avoid <b>JFK</b> and fly from <b>Stewart International Airport</b> instead. We'll want to fly <b>Emirates</b> and not <b>Southwest</b>. In Florida, we'll want to avoid <b>Orlando International Airport</b> and instead fly into <b>Miami International Airport</b>. We'll want to bring <b>clothing</b> in our carry-on and leave <b>cameras</b> in our checked bags. With the power of data science, we should get to Miami with our bags! Now, how to minimize the cost of those margaritas...</p>
 <img class="center-block" src="img/margarita.svg" alt="View" style="width:140;height:140px;">

<div class="row">
</div>

</div>


<!-- JavaScript -->
<script>
'use strict';

  /* Parse and format */
  <!-- Parsing Dates -->
  var dateParser = d3.time.format("%d-%b-%y").parse;

  // Formatting axes
  var percentFormat = d3.format(".0%");

  // Formatting decimals
  var roundFormat = d3.format(".2r");	

  /* Create chart objects */

  /* count selected records */
  var claimsCount = dc.dataCount('.dc-data-count');

  // Airport Heatmap
  var airportHeatmap = dc.geoChoroplethChart('#heatmap');
  // var heatmapKey = dc.heatMap("#heatmapKey");
  // var heatSelect = dc.selectMenu('#heat-select');

  // Percent of Denied Claims by Airport Histogram
  var percentDeniedByAirportHistogram = dc.barChart('#percent-denied-claims-by-airport-histogram');
  // var percentDeniedByAirportSelect = dc.selectMenu('#percent-denied-by-airport-select');

  //  Parallel coordinates - Correlations between Airport, Airline, Where Item was Lost, Close Amount and Disposition of Claim goes here

  // Number of Claims by Airline Histogram
  var numberClaimsByAirlineHistogram = dc.barChart('#number-claims-by-airline-histogram');
  // var numberClaimsByAirlineSelect = dc.selectMenu('#number-claims-by-airline-select');

  // Volume of Claims Line Chart
  var volumeClaimsLine = dc.lineChart('#volume-claims-line');
  // var volumeClaimsLineSelect = dc.selectMenu('#volume-claims-line-select');
  // var volumeClaimsLineSlider = dc.barChart('#volume-claims-line-slider');

  // Number of Claims by Item Type Histogram
  var numberClaimsItemHistogram = dc.pieChart('#number-of-claims-by-item-histogram');
  // var numberClaimsItemHistogramSelect = dc.selectMenu('#number-claims-item-histogram-select');


<!-- Data Input -->
  d3.csv('data/test-set.csv', function(data) {
        // Variable names
        var var1 = "ClaimNumber";
        var var2 = "DateReceived";
        var var3 = "IncidentDate";
        var var4 = "AirportCode";
        var var5 = "AirportName";
        var var6 = "AirlineName";
        var var7 = "ClaimType";
        var var8 = "ClaimSite";
        var var9 = "ItemCategory";
        var var10 = "CloseAmount";
        var var11 = "Disposition";
        var var12 = "Lat";
        var var13 = "Long";

        var var14 = "PersonalElectronics";
        var var15 = "SportingEq";
        var var16 = "Clothing";
        var var17 = "PersonalAccessories";
        var var18 = "HomeDecor";
        var var19 = "Baggage";
        var var20 = "Unknown";
        var var21 = "HouseholdItems";
        var var22 = "Cameras";
        var var23 = "Comp";
        var var24 = "Jew";
        var var25 = "Food";
        var var26 = "Other";
        var var27 = "Currency";

        data.forEach(function (d) {
          d[var1]=+d[var1];
          d[var11]=+d[var11];
          d[var12]=+d[var12];
          d[var13]=+d[var13];

          d[var14]=+d[var14];
          d[var15]=+d[var15];
          d[var16]=+d[var16];
          d[var17]=+d[var17];
          d[var18]=+d[var18];
          d[var19]=+d[var19];
          d[var20]=+d[var20];
          d[var21]=+d[var21];
          d[var22]=+d[var22];
          d[var23]=+d[var23];
          d[var24]=+d[var24];
          d[var25]=+d[var25];
          d[var26]=+d[var26];
          d[var27]=+d[var27];




          // Calculate date of claim
          d.claimDate = dateParser(d[var2]);
          d.claimMonth = d3.time.month(d.claimDate);
        });

<!-- CrossFilter -->
var ndx = crossfilter(data),
    all = ndx.groupAll(),
    heatmapAirportsDim = ndx.dimension(function(d) {return d[var4];}),
    histogramAirportsDim = ndx.dimension(function(d) {return d[var4];}),
    // parallel coordinates dimension
    histogramAirlineDim = ndx.dimension(function(d) {return d[var6];}),
    lineClaimsDim = ndx.dimension(function(d) {return d.claimMonth;}),
    histogramItemDim = ndx.dimension(function(d) {return d[var9];}),

    heatmapAirportsGroup = heatmapAirportsDim.group().reduce(
      function (p, v) {
        ++p.count;
        p.lat = v[var12];
        p.long = v[var13];
        return p;
      },
      function (p, v) {
        --p.count;
        p.lat = v[var12];
        p.long = v[var13];
        return p;
      },
      function () {
        return {
          count: 0,
          lat: 0,
          long: 0,
        };
      }
    ),
    histogramAirportsGroup = histogramAirportsDim.group().reduce(
      function (p, v) {
        ++p.count;
        p.sum += v[var11];
        p.avg = (p.sum / p.count) ? (p.sum / p.count) : 0;
        return p;
      },
      function (p, v) {
        --p.count;
        p.sum -= v[var11];
        p.avg = (p.sum / p.count) ? (p.sum / p.count) : 0;
        return p;
      },
      function () {
        return {
          count: 0,
          sum: 0,
          avg: 0
        };
      }
    ),
    //parallel coordinates
    histogramAirlineGroup = histogramAirlineDim.group().reduce(
      function (p, v) {
        ++p.count;
        return p;
      },
      function (p, v) {
        --p.count;
        return p;
      },
      function () {
        return {
          count: 0
        };
      }
    ),
    lineClaimsGroup = lineClaimsDim.group().reduce(
      function (p, v) {
        ++p.count;
        p.sum += v[var11];
        p.avg = (p.sum / p.count);
        return p;
      },
      function (p, v) {
        --p.count;
        p.sum -= v[var11];
        p.avg = (p.sum / p.count);
        return p;
      },
      function () {
        return {
          count: 0,
          sum: 0,
          avg: 0
        };
      }
    ),
    histogramItemGroup = histogramItemDim.group();

    // Groups to allow the item chart
     var runDimension  = ndx.dimension(function(d) {
      return "Test";
    }),
    speedSumGroup = runDimension.group().reduce(function(p,v) {
	  p.v14+=v.PersonalElectronics;
	  p.v15+=v.SportingEq;
	  p.v16+=v.Clothing;
	  p.v17+=v.PersonalAccessories;
	  p.v18+=v.HomeDecor;
	  p.v19+=v.Baggage;
	  p.v20+=v.Unknown;
	  p.v21+=v.HouseholdItems;
	  p.v22+=v.Cameras;
	  p.v23+=v.Comp;
	  p.v24+=v.Jew;
	  p.v25+=v.Food;
	  p.v26+=v.Other;
	  p.v27+=v.Currency;
      return p;
    }, function(p,v) {
	  p.v14-=v.PersonalElectronics;
	  p.v15-=v.SportingEq;
	  p.v16-=v.Clothing;
	  p.v17-=v.PersonalAccessories;
	  p.v18-=v.HomeDecor;
	  p.v19-=v.Baggage;
	  p.v20-=v.Unknown;
	  p.v21-=v.HouseholdItems;
	  p.v22-=v.Cameras;
	  p.v23-=v.Comp;
	  p.v24-=v.Jew;
	  p.v25-=v.Food;
	  p.v26-=v.Other;
	  p.v27-=v.Currency;
      return p;
    }, function() {
      return { v14: 0, v15: 0, v16:0,v17: 0, v18: 0, v19:0,v20: 0, v21: 0, v22:0,v23: 0, v24: 0, v25:0,v26: 0, v27: 0 }
    });
    var fakeGroup = {
	  all: function() {
		 return [
	    { key: "Personal Electronics", value: speedSumGroup.top(1)[0].value.v14 },
	    { key: "SportingEquipment", value: speedSumGroup.top(1)[0].value.v15 },
	    { key: "Clothing", value: speedSumGroup.top(1)[0].value.v16 },
	    { key: "Personal Accessories", value: speedSumGroup.top(1)[0].value.v17 },
	    { key: "Home Decor", value: speedSumGroup.top(1)[0].value.v18 },
	    { key: "Baggage", value: speedSumGroup.top(1)[0].value.v19 },
	    { key: "Unknown", value: speedSumGroup.top(1)[0].value.v20 },
	    { key: "Household Items", value: speedSumGroup.top(1)[0].value.v21 },
	    { key: "Cameras", value: speedSumGroup.top(1)[0].value.v22 },
	    { key: "Computers", value: speedSumGroup.top(1)[0].value.v23 },
	    { key: "Jewelry", value: speedSumGroup.top(1)[0].value.v24 },
	    { key: "Food", value: speedSumGroup.top(1)[0].value.v25 },
	    { key: "Other", value: speedSumGroup.top(1)[0].value.v26 },
	    { key: "Currency", value: speedSumGroup.top(1)[0].value.v27 },

	  ]; }
	}


// airportHeatmap is moved to end of file due to call to renderAll within the JSON callback
// console.log(heatmapAirportsGroup.top(Infinity));





<!-- Histogram - Percent of Denied Claims by Airport -->
// A hack to allow sorting
histogramAirportsGroup.order(function(d) {
	// console.log(d);
    return d.avg;
});

histogramAirportsGroup.all = function() {
    return histogramAirportsGroup.top(Infinity);
}

percentDeniedByAirportHistogram
    .width(1250)
    .height(200)
    .dimension(histogramAirportsDim)
    .group(histogramAirportsGroup)
    .yAxisLabel("Percent of Claims Denied")
    .xAxisLabel("Airport")
    // due to 0 to 100 percent range of denied claims
    .x(d3.scale.ordinal().domain(function(d) {return d.key;}))
    .valueAccessor(function (d) { return d.value.avg;})
    .keyAccessor(function(d) { return d.key; })
    .centerBar(false)
    .elasticX(true)
    .elasticY(true)
    .title(function(d) {return d.key + ": " + percentFormat(d.value.avg) + " denied"})
    .xUnits(dc.units.ordinal)
    .ordering(function(d){
    return d.value.avg })
    .xAxis().tickFormat(function(d) { return ""; });
  percentDeniedByAirportHistogram.yAxis().ticks(6);
  percentDeniedByAirportHistogram.yAxis().tickFormat(percentFormat);

<!-- Parallel Coordinates - Correlations between Airport, Airline, Where Item was Lost, Close Amount and Disposition of Claim -->


<!-- Histogram - Number of Claims by Airline -->
// A hack to allow sorting
histogramAirlineGroup.order(function(d) {
	// console.log(d);
    return d.count;
});

histogramAirlineGroup.all = function() {
    return histogramAirlineGroup.top(Infinity);
}


numberClaimsByAirlineHistogram
  .width(1250)
  .height(200)
  .dimension(histogramAirlineDim)
  .group(histogramAirlineGroup)
  .yAxisLabel("Number of Claims")
  .xAxisLabel("Airline")
  .x(d3.scale.ordinal().domain(function(d) {return d.key;}))
  .y(d3.scale.sqrt().domain([0, 1400]))
  .valueAccessor(function (d) { return d.value.count;})
  .keyAccessor(function(d) { return d.key; })
  .elasticX(true)
  .elasticY(true)
  .xUnits(dc.units.ordinal)
  .ordering(function(d){
    return d.value.count })
  .title(function(d) {return d.key + ": " + d.value.count + " claims"})
  .xAxis().tickFormat(function(d) { return ""; });
  // .valueAccessor(function (d) { return d.value.count;  })
  // .keyAccessor(function(d) { return d.key; });


<!-- Line chart - Volume of Claims: -->
volumeClaimsLine
  .width(1250)
  .height(200)
  // .chart(function(c) { return dc.lineChart(c).interpolate('linear');})
  .x(d3.time.scale().domain([new Date(2015, 0, 1), new Date(2015, 11, 31)]))
  // .xUnits(dc.units.ordinal)
  .yAxisLabel("Number of Claims")
  .xAxisLabel('Date')
  .elasticY(true)
  .dimension(lineClaimsDim)
  .group(lineClaimsGroup)
  .valueAccessor(function (d) {return d.value.count;})
  .keyAccessor(function(d) {return d.key;})
  .renderHorizontalGridLines(true);
  // .legend(dc.legend().x(600).y(0).itemHeight(10).gap(3).horizontal(2).legendWidth(140).itemWidth(40));
volumeClaimsLine.yAxis().ticks(6);


<!-- Histogram - Number of Claims by Item Type -->
numberClaimsItemHistogram
	.dimension(runDimension)
    .group(fakeGroup)
     .title(function(d) {return d.key + ": " + d.value + " claims"})
     .width(768)
		  .height(480)
		  .innerRadius(100)			
		  .externalLabels(50)
		  .externalRadiusPadding(50)
		  .legend(dc.legend())
		  .label(function(d) {return ""});

numberClaimsItemHistogram.on('pretransition', function(chart) {
          chart.selectAll('.dc-legend-item text')
              .text('')
            .append('tspan')
              .text(function(d) { return d.name; })
            .append('tspan')
              .attr('x', 150)
              .attr('text-anchor', 'end')
              .text(function(d) { return d.data; });
               });
<!-- Count selected records widget -->

claimsCount
    .dimension(ndx)
    .group(all)
    .html({
        some: '<strong>%filter-count</strong> selected out of <strong>%total-count</strong> records' +
            ' | <a href=\'javascript:dc.filterAll(); dc.renderAll();\'>Reset All</a>',
        all: 'All records selected. Please click on the graph to apply filters.'
    });


d3.json("/json/us-states.json", function (statesJson) {

	<!-- HeatMap - Airports by Volume of Claims -->
	airportHeatmap
		.width(990)
		.height(500)
		.dimension(heatmapAirportsDim)
		.group(heatmapAirportsGroup)
		.colors(d3.scale.quantize().range(["#E2F2FF", "#C4E4FF", "#9ED2FF", "#81C5FF", "#6BBAFF", "#51AEFF", "#36A2FF", "#1E96FF", "#0089FF", "#0061B5"]))
	    .colorDomain([0, 200])
	    .colorCalculator(function (d) { return d ? airportHeatmap.colors()(d) : '#ccc'; })
        .overlayGeoJson(statesJson.features, "state", function (d) {
            return d.properties.name;
        })
        .valueAccessor(function(kv) {
            // console.log(kv);
            return kv.value.count;
        })	
        .title(function (d) {
        	
        	// console.log(d);
                        return "State: " + d.key;
        })
        .on("renderlet", drawAdditionalStuffInMap);		

        function drawAdditionalStuffInMap(_chart, selection) {
		    var svg = _chart.svg();
		    svg.selectAll("g.additionalStuff").remove();

		    var group = svg.selectAll("g.additionalStuff");

		    if (group.empty()) {
		        group = svg.append("g").classed("additionalStuff", true);
		    }

            var proj = airportHeatmap.geoPath().projection();
            var nodes = group.selectAll("circle").data(heatmapAirportsGroup.top(Infinity),
            	function(d) {
            		var posn = proj([d.value.long, d.value.lat]);
            		// console.log(posn); 
            		if (posn !== null) {
            			return [posn[0], posn[1], d.value.count];
            		}
            		else {
            			return [0,0,0];
            		}
            	})	

            // nodes.enter()
            // 	.append("circle")
            		// .attr("x", function(d){return d[0]})
            		// .attr("y", function(d){return d[1]})
		    //you need to implement calculateAdditionalDataPoints
		    // var additionalData = calculateAdditionalDataPoints();
		    // var additionalNodes = group.selectAll("circle").data(additionalData, function(x) { return x.id; });


		    // _chart.dimension().top(Infinity).map(function(d) {
		    //         d.location = proj([d.Long, d.Lat]);
		    //         return d;
		    // });


		    // });

		    nodes.enter()
		        .append("svg:image")
		            .attr("x", 0)
		            .attr("y", 0)
		            .attr('width', function(d) {return 3*Math.sqrt(d.value.count)})
				   	.attr('height', function(d) {return 3*Math.sqrt(d.value.count)	})
				   	.attr("xlink:href","img/airplane-shape.svg")
		            // .attr("r", function(d) {return d.value.count})
		            .attr("transform", function(d){
		             var posn = proj([d.value.long, d.value.lat]);
		             // console.log(d); 
		             if (posn !== null) {
		           	  return "translate(" + posn[0] + "," + posn[1] + ")"; 
		        	 }
		        	 else {
		        	 	return "translate(" + 120 + "," + 200 + ")";
		        	 }})
	            .append("title")
				  .text(function(d) { return "\n" +d.key+"\n"+d.value.count + " claims"; });;

		    nodes.exit().remove();
}	


	<!-- Render -->
	dc.renderAll();
	// console.log(airportHeatmap.geoPath().projection());
	// console.log(histogramAirportsGroup.top(Infinity));
});


// end of data input callback
  });

</script>
</body>
